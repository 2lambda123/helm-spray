language: go

go:
  - 1.10.x

go_import_path: github.com/gemalto/helm-spray

install:

script:
- make dist

before_deploy:
- git config --local user.name "Travis CI"
- git config --local user.email "travis@travis-ci.org"
- export TRAVIS_TAG=$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)
- git tag "$TRAVIS_TAG" "$TRAVIS_COMMIT"
- git push origin --tags

deploy:
- provider: releases
  api_key: ${GITHUB_TOKEN}
  file: _dist/helm-spray*
  skip_cleanup: true
  file_glob: true
  on:
    repo: cvila84/helm-spray
    tags: true
